# 群晖系统部署教程

## 部署步骤

### 1. 搜索并下载 Docker 镜像

1. 打开群晖自带的 **Docker** 应用。
2. 在注册表中搜索 `hujinbo`。
3. 选择搜索结果中的镜像，点击下载。
4. 手动选择 `1.5.0` 版本，或者直接选择自动下载最新版本。

![](/images/synology/synology1.png)

### 2. 创建必要的文件夹

在开始创建容器之前，需要在群晖的文件系统中提前创建好相应的文件夹。

1. 在你希望存放数据的目录下（例如 `docker` 目录），创建一个名为 `dst` 的文件夹。
2. 在 `dst` 文件夹内，创建以下三个子文件夹：
   - `backup`
   - `mod`
   - `root`
3. 进入 `root` 文件夹，再创建一个名为 `app` 的子文件夹。
4. 最后，在 `app` 文件夹内创建一个名为 `dst-dedicated-server` 的子文件夹。

至此，文件夹创建步骤已经完成。

### 3. 创建并配置 Docker 容器

我们开始创建容器。本教程基于 **DSM 7.2** 系统编写，低版本系统相关步骤可能略有不同，请注意区分。

1. 在 Docker 应用的 **映像** 菜单中，找到我们刚才下载好的服务器镜像。
2. 右键点击该镜像，选择 **启动** 或 **创建容器**。
3. （可选）在容器设置中，可以勾选 **启用自动重新启动** 选项。建议在你最后测试好服务器运行正常后再开启此选项。

![](/images/synology/synology2.png)

#### 3.1 路由器端口映射

在你的路由器管理界面中，需要做对应的端口映射：

- **管理面板端口**：`8082` (TCP)
- **游戏服务器端口**：`10998` 到 `11018` (UDP)。可以配置为范围端口映射。
  - 例如，将外部端口 `10998-11018` 映射到群晖 IP 的 `10998-11018`。
- 端口映射的 **本地 IP** 请填写你的群晖系统在局域网中的 IP 地址。

![](/images/synology/synology3.png)

#### 3.2 映射本地文件夹

接下来，我们需要将刚才创建好的文件夹映射到容器内部。

1. 在容器创建向导中，找到 **卷** 或 **文件夹映射** 设置。
2. 按照下表添加映射：

| 本地文件夹路径 (宿主机)        | 容器内路径 (Mount path)        |
| ------------------------------ | ------------------------------ |
| `/docker/dst/backup`     | `/app/dst/save`                |
| `/docker/dst/mod`        | `/app/dst/mod`                 |
| `/dst/root/app/dst-dedicated-server` | `/app/dst/dst-dedicated-server` |

![](/images/synology/synology4.png)

> **注意**：这里的映射目录可能和网上其他教程略有不同。这是经过本人测试后，确认核心文件夹能方便进行可视化管理的方案。如果有不同想法，欢迎自行进一步测试。这里只保证这样映射能较方便地管理饥荒服务器面板，但不一定是唯一或最“正确”的映射方案。

#### 3.3 设置环境变量与网络

1. 在容器设置中，找到 **环境变量** 部分。
2. 添加一个环境变量：
   - **键 (Key)**: `TZ`
   - **值 (Value)**: `Asia/Shanghai` (或你所在的时区，例如 `UTC`)
     ![](/images/synology/synology5.png)
   
3. 在容器设置中，找到 **网络** 部分。
4. 将网络类型选择为 **host** (主机网络模式)。
   ![](/images/synology/synology6.png)

### 4. 启动容器

完成以上所有设置后，点击 **应用** 或 **完成** 以保存并启动容器。

容器搭建到这一步基本就结束了。接下来就是等待容器下载并安装各种必需的组件（如 SteamCMD 和 饥荒专用服务器）。

### 5. 访问管理面板

组件下载和配置完成后，你就可以访问管理面板了：

- **局域网访问**：在浏览器中访问 `http://你的群晖局域网IP:8082`。
- **公网访问**：在浏览器中访问 `http://你的公网IP:8082` 或 `http://你的域名:8082` (如果你配置了域名解析)。

面板的具体设置可以参考项目提供的其他教程，此处不再赘述。